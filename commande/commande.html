<!-- PROTOTYPE : Configurateur ISOTUILES (page unique HTML)
  - Héberger sur GitHub Pages (index.html)
  - Intégrer en iframe dans Shopify
  - Charge les données via OpenSheet (Sheet ID fourni)
  - Multi-steps, scroll automatique, précédente/suivante, barre de progression
  - Overlay latéral affichant le prix HT en direct
  - Sauvegarde locale, génération PDF, envoi du récapitulatif via postMessage au parent

  REMARQUE :
  - TVA par défaut = 20% (modifier la variable VAT_RATE ci-dessous si besoin)
  - Le fichier suppose que vos feuilles s'appellent : "panneaux", "accessoires", "transport"
  - Pour ajout automatique au panier Shopify, le thème parent doit écouter le postMessage et ajouter les lignes au panier (snippet exemple fourni en commentaire plus bas).
-->

<!doctype html>
<html lang="fr">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Configurateur ISOTUILES — Prototype</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
        integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="../styles/order-form.css">
    <!-- // Dependencies: jsPDF via CDN for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

</head>

<body>

    <div class="page">
        <main class="main">

            <div id="loadingSpinner" style="display:flex;align-items:center;justify-content:center;height:100vh;">
                <div
                    style="border:4px solid #ccc;border-top:4px solid #333;border-radius:50%;width:40px;height:40px;animation:spin 1s linear infinite;">
                </div>
            </div>
            <style>
                @keyframes spin {
                    from {
                        transform: rotate(0deg);
                    }

                    to {
                        transform: rotate(360deg);
                    }
                }
            </style>


            <button id="btnReset" type="button">Réinitialiser</button>

            <div class="card">
                <div style="display:flex;align-items:center;justify-content:space-between">
                    <h2>Configurateur ISOTUILES</h2>
                    <small id="savedState" style="color:var(--muted)"></small>
                </div>

                <div class="progress"><i id="progressBar"></i></div>

                <div class="steps" id="stepsContainer">
                    <!-- Step 1: Choisir panneau -->
                    <section class="step" data-step="1" id="step-1">
                        <h3>1 • Choisissez votre panneau</h3>
                        <div class="field">
                            <label for="selectPanneau">Modèle / Variante
                                <select id="selectPanneau">
                                    <option>Choisir un panneau</option>
                                </select></label>
                        </div>
                        <div class="field">
                            <label>
                                <input type="number" id="inputLongueur" min="2.1" max="12.25" step="0.01" value="2.10">
                                Longueur par panneau (m)
                            </label>
                        </div>
                        <div class="field">
                            <label>
                                <input type="number" id="inputQuantite" min="1" step="1" value="1">
                                Quantité de panneaux
                            </label>
                        </div>
                    </section>

                    <!-- Step 2: Accessoires -->
                    <section class="step hidden" data-step="2" id="step-2">
                        <h3>2 • Accessoires associés</h3>
                        <div id="accessoriesList"></div>
                    </section>

                    <!-- Step 3: Options livraison / contact -->
                    <section class="step hidden" data-step="3" id="step-3">
                        <h3>3 • Livraison & contact</h3>
                        <div class="field"><label>
                                <input type="text" id="inputPostal" placeholder="Ex: 33480">
                                Code postal (pour info transport)
                            </label>
                        </div>
                        <div class="field"><label>
                                <input type="text" id="inputName">
                                Nom / Société</label>
                        </div>
                        <div class="field"><label>
                                <input type="email" id="inputEmail">
                                Email</label>
                        </div>
                        <div class="field"><label>
                                <input type="text" id="inputPhone">
                                Téléphone (optionnel)</label>
                        </div>
                    </section>

                    <!-- Step 4: Récapitulatif -->
                    <section class="step hidden" data-step="4" id="step-4">
                        <h3>4 • Récapitulatif & devis</h3>
                        <div id="recapDetails"></div>
                        <div style="margin-top:12px;display:flex;gap:8px">
                            <button id="btnDownloadPdf" class="secondary">Télécharger le devis (PDF)</button>
                            <button id="btnSendToCart">Valider et ajouter au panier</button>
                        </div>
                    </section>
                </div>

                <div class="controls">
                    <button id="btnPrev" class="secondary">Précédent</button>
                    <div style="margin-left:auto;display:flex;gap:8px">
                        <button id="btnNext">Suivant</button>
                    </div>
                </div>

            </div>
        </main>

        <aside class="overlay">
            <h3>Panier & estimation</h3>
            <div class="lines" id="overlayLines"></div>
            <div class="total">
                <div>Estimation (HT) : <span id="overlayTotalHt">0.00 €</span></div>
                <div style="font-size:0.9rem;color:var(--muted);margin-top:6px">TVA : <span id="vatRate"></span></div>
            </div>
        </aside>
    </div>

    <script src="./order-form.js"></script>

</body>

</html>